<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<link rel="icon" type="image/svg+xml" href="favicon.svg" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Pinecone Router Simple Example</title>
		<!--Import Pinecone Router-->
		<script src="https://cdn.jsdelivr.net/npm/pinecone-router@0.1.1/dist/index.umd.js"></script>
		<!--Import Alpine.js-->
		<script
			src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js"
			defer
		></script>
	</head>
	<body>
		<div
			x-data="{show:true}"
			@pinecone-end.window="show=false"
			@pinecone-start.window="show=true"
			x-show="show"
		>
			imagine this a fancy loading bar.
		</div>
		<div x-data="router()" x-router>
			<template x-route="/" x-handler="home"></template>
			<template x-route="/hello" x-handler="hello"></template>
			<!-- routes can share handlers, and have multiple handlers!
				here we use the same handler as above (hello), and a new one to check the name (checkname). -->
			<template
				x-route="/hello/:name"
				x-handler="checkname, hello"
			></template>
			<!-- the 404 page handler -->
			<template x-route="notfound" x-handler="notfound"></template>
		</div>

		<div id="app" class="text-center p-6 w-sm mx-auto" x-data></div>

		<script>
			// the router component.
			function router() {
				return {
					home(context) {
						document.querySelector('#app').innerHTML = `
						<h1 class="font-bold prose-lg">Home</h1>
						<a class="underline" href="/hello">Hello World</a>
						<br>
						<a class="underline" href="/test">A non-existing route</a>
						`;
					},

					hello(context) {
						let name;

						// this handler is for /hello and /hello/:world
						// the context comes handy in telling us which route it is.
						if (context.route == '/hello/:name') {
							// this means the user is at /hello/something
							// where something is the context.props.name
							name = context.props.name;
						} else {
							// the user is at /hello, ask them for their name
							name = 'What is your name?';
						}

						document.querySelector('#app').innerHTML = `
						<h1>Hello, ${name}</h1>
						<!-- This isn't very clear since it's in a string
							so what this does is every time the input change, use the $router magic helper to redirect
							to /hello/input where input is the user input. -->
						<input type="text" @change="$router.redirect('/hello/' + event.target.value)">
						<p>Tip: write 'home' to go to the home page.</p>
						`;
					},

					// this will handle the 404 routes
					notfound(context) {
						document.querySelector('#app').innerHTML = `
						<h1>404 Not Found</h1>
						<p>The page ${context.path} doesn't exist</p>
						<button class="underline" @click="$router.redirect('/')">Go Home</button>
						`;
					},

					// this will validate the name in the /hello/:name route
					checkname(context) {
						if (context.props.name.toLowerCase() == 'home') {
							// redirecting is as easy as return the context.redirect function.
							return context.redirect('/');
						}
					},
				};
			}
		</script>

		<script type="module" src="/main.js"></script>
	</body>
</html>
